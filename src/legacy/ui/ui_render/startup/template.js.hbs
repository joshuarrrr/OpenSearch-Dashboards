// TODO: fix boolean/string coerce issues
var rawDarkMode = window.localStorage.getItem('uiSettings:theme:darkMode') || {{configDarkMode}};

var rawThemeVersion = window.localStorage.getItem('uiSettings:theme:version') || '{{configThemeVersion}}'

// TODO: should this reflect config defaults instead?
var darkMode = rawDarkMode ? 'dark' : 'light';
var themeVersion = rawThemeVersion === 'v7' ? 'v7' : 'v8';

window.__osdThemeTag__ = themeVersion + darkMode;

var themeSourceKey = themeVersion === 'v7' ? 'v7' : 'default';

var themeSources = {{THEME_SOURCES}};

var themeDefinition = themeSources[themeVersion][darkMode];

var stylesheetTarget = document.querySelector('head meta[name="add-styles-here"]');

var themedStylesDom = document.createElement('style');

themedStylesDom.innerHTML = `
  :root {
    color-scheme: ${darkMode ? 'dark' : 'light'};
  }
  .osdWelcomeView {
    background-color: ${themeDefinition.euiHeaderBackgroundColor};
  }
  .osdWelcomeTitle {
    color: ${themeDefinition.euiColorFullShade};
  }
  .osdWelcomeText {
    color: ${themeDefinition.euiColorDarkShade};
  }
  .osdProgress {
    background-color: ${themeDefinition.euiColorLightestShade};
  }
  .osdProgress:before {
    background-color: ${themeDefinition.euiColorPrimary};
  }
`

document.head.insertBefore(themedStylesDom, stylesheetTarget);

var fontTexts = {{fontText}};
var fontCodes = {{fontCode}};

var fontText = fontTexts[themeSourceKey];
var fontCode = fontCodes[themeSourceKey];

var fontTarget = document.querySelector('head meta[name="add-fonts-here"]');

var themedFontDom = document.createElement('style');

themedFontDom.innerHTML = `
  :root {
    --font-text: "${fontText}", -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial,
                sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";

    --font-code: "${fontCode}", Consolas, Menlo, Courier, monospace;

    --oui-font-family: var(--font-text);
    --oui-code-font-family: var(--font-code);
  }

  code, pre, kbd, samp {
    font-family: var(--font-code);
  }
  html, input, textarea, select, button {
    font-family: var(--font-text);
  }
`;

document.head.insertBefore(themedFontDom, fontTarget);
